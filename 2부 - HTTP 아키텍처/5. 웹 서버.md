# 웹 서버

이번 장에서는 다음에 대해 알아봅니다.

* 여러 종류의 소프트웨어 및 하드웨어 웹 서버에 대해 조사
* HTTP 통신을 진단하는 간단한 웹 서버 작성(Perl)
* 어떻게 웹 서버가 HTTP 트랜잭션을 처리하는지 단계별로 설명

## 5.1  다채로운 웹 서버

* `웹 서버`라는 용어는 웹 서버 소프트웨어와 웹 페이지 제공에 특화된 장비 양쪽 모두를 가리킵니다.

### 5.1.1 웹 서버 구현

* 웹 서버는 HTTP 프로토콜을 구현하고, 웹 리소스를 관리하고, 웹 서버 관리 기능을 제공합니다.
* 웹 서버는 TCP 커넥션에 대한 책임을 운영체제와 나눠 갖습니다.


## 5.2 간단한 펄 웹 서버

* 다음의 코드는 `type-o-serve`라는 작은 펄 프로그램입니다.

```perl
#!/usr/bin/perl
use Socket;
use Carp;
use FileHandle;

# (1) use port 8080 by default, unless overridden on command
line

$port = (@ARGV ? $ARGV[0] : 8080);

# (2) create local TCP socket and set it to listen for
connections
$proto = getprotobyname('tcp');
socket(S, PF_INET, SOCK_STREAM, $proto) || die;
setsockopt(S, SOL_SOCKET, SO_REUSEADDR, pack("l", 1)) || die;
bind(S, sockaddr_in($port, INADDR_ANY)) || die;
listen(S, SOMAXCONN) || die;

# (3) print a startup message
printf("    <<<Type-O-Serve Accepting on Port%d>>>\n\n",$port);

while (1) {
    # (4) wait for a connection C
    $cport_caddr = accept(C, S);
    ($cport,$caddr) = sockaddr_in($cport_caddr);
    C->autoflush(1);

    # (5) print who the connection is from
    $cname = gethostbyaddr($caddr,AF_INET);
    printf("    <<<Request From '%s'>>>\n",$cname);

    # (6) read request msg until blank line, and print on
    screen
    while ($line = <C>) {
        print $line;
        if ($line =~ /^\r/) { last; }
    }
    
    # (7) prompt for response message, and input response lines,
    #     sending response lines to client, until solitary "."
    printf("    <<<Type Response Followed by '.'>>>\n");
    
    while ($line = <STDIN>) {
        $line =~ s/\r//;
        $line =~ s/\n//;
        if ($line =~ /^\./) { last; }
        print C $line . "\r\n";
    }
    close(C);
}
```

* 위의 코드를 죠의 하드웨어 상점에서 테스트할 때 다음과 같은 그림으로 나타낼 수 있습니다.

<img width="715" alt="2019-01-22 1 10 38" src="https://user-images.githubusercontent.com/13018877/51485905-9324fd00-1de2-11e9-9b5b-44c3bd9652bd.png">

