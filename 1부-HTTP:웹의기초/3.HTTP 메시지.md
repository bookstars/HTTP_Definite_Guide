# HTTP 메시지

-   메시지가 어떻게 흘러가는가
-   HTTP 메시지의 세 부분(시작줄, 헤더, 개체 본문)
-   요청과 응답 메시지의 차이
-   요청 메세지가 지원하는 여러 기능(메서드)들
-   응답 메시지가 반환하는 여러 상태 코드들
-   여러 HTTP 헤더들은 무슨 일을 하는가

## 3.1 메시지의 흐름

-   HTTP 메시지는 HTTP 애플리케이션 간에 주고받는 데이터 블록들로, 메세지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 다음에 선택적으로 데이터가 올 수 있는 구조로 되어있습니다.

-   이러한 메시지는 클라이언트, 서버, 프락시 사이를 흐릅니다.

-   메시지의 방향은 '**인바운드**', '**아웃바운드**', '**업스트림**', '**다운스트림**'으로 표현됩니다.

### 3.1.1 메시지는 원 서버 방향을 인바운드로 하여 송신됩니다.

-   메시지가 원 서버로 향하는 것은 **인바운드**로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 **아웃바운드**로 이동하는 것입니다.

**인바운드와 아웃바운드**

-   HTTP의 트랜잭션 방향을 표현하기 위해 사용 됩니다.

<img width="573" alt="2018-12-30 1 35 26" src="https://user-images.githubusercontent.com/44794974/50544415-deab1780-0c37-11e9-912d-b57f7539d11d.png">

### 3.1.2 다운스트림으로 흐르는 메시지

-   HTTP 메시지는 요청 메시지나 응답 메시지 관계없이 **다운스트림**으로 흐릅니다. (그림 3-2 참고)

<img width="446" alt="2018-12-30 1 43 29" src="https://user-images.githubusercontent.com/44794974/50544446-ee772b80-0c38-11e9-9375-07ce5b6384c1.png">

## 3.2 메시지의 각 부분

-   HTTP 메시지는 시작줄, 헤더 블록, 본문 세 부분으로 이루어집니다.

-   **시작줄**은 이것이 어떤 메시지인지 서술합니다.

-   **헤더 블록**은 속성을 나타냅니다.

-   **본문**은 데이터를 담고 있습니다.(없을 경우도 있슴)

<img width="503" alt="2018-12-30 1 50 04" src="https://user-images.githubusercontent.com/44794974/50544476-d8b63600-0c39-11e9-844e-beada33ab118.png">

### 3.2.1 메시지 문법

<img width="559" alt="2018-12-30 1 54 38" src="https://user-images.githubusercontent.com/44794974/50544493-7e69a500-0c3a-11e9-98ec-3da6ef4e30b3.png">

#### 요청 메시지의 형식

```
    <메서드> <요청 URL> <버전>
    <헤더>

    <엔터티 본문>
```

#### 응답 메시지의 형식

```
    <버전> <상태 코드> <사유 구절>
    <헤더>

    <엔터티 본문>
```

-   **메서드**는 클라이언트 측에서 서버가 리소스에 대해 요청하는 동작입니다.(ex, 'GET', 'HEAD', 'POST')

-   **요청 URL** 요청 대상이 되는 리소스를 지칭하는 URL의 경로 구성요소입니다.[(2장 참조)](https://github.com/bookstars/HTTP_Definite_Guide/blob/master/1%EB%B6%80-HTTP:%EC%9B%B9%EC%9D%98%EA%B8%B0%EC%B4%88/2.URL%EA%B3%BC%20%EB%A6%AC%EC%86%8C%EC%8A%A4.md)

-   **버전**은 메시지에서 사용중인 HTTP 버전입니다.

```
    HTTP/<메이저>.<마이너>
```

-   **상태코드**는 요청 중에 무엇이 일어났는지 설명하는 세 자리 숫자로, 첫번째 자리수는 상태의 일반적인 불류를 나타내고(ex, '성공', '에러') 뒷 부분에 좀 더 디테일한 상태를 나타냅니다. (뒷부분 참고)

-   **사유구절**은 숫자로 된 상태코드의 의미를 설명해주는 짧은 구절로, 오로지 사람에게 읽히기 위한 목적으로만 쓰인다.

-   **헤더들**은 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 값들을 의미합니다. (뒷부분 참고)

-   **엔터티 본문**은 임의듸 데이터 블록으로 15장에서 보다 자세히 다룰 것입니다.

### 3.2.2 시작줄

-   모든 HTTP 메시지는 시작줄로 시작합니다.

-   **요청 메시지 시작줄**은 무엇을 해야 하는지 알려줍니다.

-   **응답 메시지 시작줄**은 무슨 일이 일어났는지 말해줍니다.

#### 요청줄(요청 메시지의 시작줄)

요청줄은 **메서드**, **요청 URL**, **HTTP 버전** 정보를 가지고 있습니다.

#### 응답줄

응답줄에서는 응답 메시지에서 쓰인 **HTTP 버전**, 숫자로 된 **상태 코드**, 텍스트로 된 **사유 구절**이 들어 있습니다.

#### 메서드

HTTP 명세는 다음과 같은 공통 요청 메서드의 집합을 정의합니다.

<img width="593" alt="2018-12-30 3 00 31" src="https://user-images.githubusercontent.com/44794974/50544735-b0cbd000-0c43-11e9-956a-6eb7433c2321.png">
<img width="588" alt="2018-12-30 3 00 36" src="https://user-images.githubusercontent.com/44794974/50544741-bd502880-0c43-11e9-9919-cd3d98781a22.png">

또한, HTTP는 쉽게 확장할 수 있도록 설계되어 추가로 메서드를 추가로 구현할 수 있습니다. 이러한 매서드를 **확장 메서드**라고 합니다.

#### 메서드

HTTP 명세는 다음과 같은 공통 요청 메서드의 집합을 정의합니다.

또한, HTTP는 쉽게 확장할 수 있도록 설계되어 추가로 메서드를 추가로 구현할 수 있습니다. 이러한 매서드를 **확장 메서드**라고 합니다.

#### 상태 코드

**상태 코드**는 클라이언트에게 무엇이 일어났는지 말해주고, **상태 코드**들은 세 자리 숫자로 된 그들의 코드값을 기준으로 묶입니다.

<img width="586" alt="2018-12-30 3 08 59" src="https://user-images.githubusercontent.com/44794974/50544813-e7eeb100-0c44-11e9-841e-de84453d3ce8.png">

-   **200~299**까지는 성공을 나타냅니다.

-   **300~399**까지는 코드의 리소스가 옮겨졌을을 뜻합니다.

-   **400~499**까지는 클라이언트가 뭔가 잘못된 요청을 했음을 의미합니다.

-   **500~599**까지는 서버에서 먼가 실패했음을 의미합니다.

자세한 내용은 뒷장에서 더 설명하도록 하겠습니다.

### 3.2.3 헤더

#### 헤더 분류

-   일반 헤더 : 요청과 응답 양쪽에 모두 나타날 수 있습니다.

-   요청 헤더 : 요청에 대한 부가 정보를 제공합니다.

-   응답 헤더 : 응답에 대한 부가 정도를 제공합니다.

-   Entity 헤더 : 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술합니다.

-   확장 헤더 : 명세에 정의되지 않는 새로운 헤더 입니다.

### 3.2.4 엔터티 본문

HTTP가 건네줄 정보를 뜻합니다. HTTP는 이러한 정보를 전달하기 위해 설계된 것입니다.

## 3.3 메서드

### 3.3.1 안전한 메서드(Safe Method)

HTTP는 **안전한 메서드**라 불리는 메서드의 집합을 정의합니다. **안전한 메서드**의 목적은, 서버에 어떤 영향을 줄 수 있는 안전하지 않은 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 HTTP 애플리케이션을 만들 수 있도록 하는 것에 있습니다.

#### 3.3.2 GET

**GET** 메서드는 주로 서버에게 리소스를 달라고 요청하기 위해 쓰입니다.

#### 3.3.3 HEAD

GET과 비슷하게 행동하지만, **HEAD**는 서버의 응답으로 헤더만 돌려줍니다.

-   리소스를 가져오지 않고도 그에 대해 무엇인가(타입이라거나)를 알아낼 수 있습니다.
-   응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있습니다.
-   헤더를 확인하여 리소스가 변경되었는지 검사할 수 있습니다.

#### 3.3.4 PUT

**PUT** 메서드는 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나, 이미 URL이 존재한다면 본문을 사용해서 교체하는 것입니다.

#### 3.3.5 POST

**POST** 메서드는 서버에 입력 데이터를 전송하기 위해 사용됩니다.

#### 3.3.6 TRACE

**TRACE** 메서드는 클라이언트에게 자신의 요청이 서버에 도달했을 때 어떻게 보이게 되는지 알려줍니다.

#### 3.3.7 OPTIONS

**OPTIONS** 메서드는 웹 서버에서 여러 가지 종류의 지원 버위에 대해 불어볼때 사용합니다.(어떤 메서드가 지원되는지)

#### 3.3.8 DELETE

**DELETE** 메서드는 서버에게 요청 URL로 지정한 리소스를 삭제할 것을 요청한다.

#### 3.3.9 확장 메서드

HTTP는 쉽게 확장할 수 있도록 설계되어 추가로 메서드를 추가로 구현할 수 있습니다. 이러한 매서드를 **확장 메서드**라고 합니다.

## 3.4 상태 코드

**3.2**에서 보았듯이 HTTP 상태 코드는 크게 다섯 가지로 나뉩니다. 이번 절에서는 HTTP 상태 코드의 디테일한 부분을 다루어 보겠습니다.

### 3.4.1 100-199: 정보성 상태 코드

<img width="582" alt="2018-12-30 11 13 14" src="https://user-images.githubusercontent.com/44794974/50548003-cb746800-0c88-11e9-9700-7be18599faaf.png">

-   100 Continue는 HTTP 클라이언트 애플리케이션이 서버에 언터티 본문을 전송하기 전에 그 엔터티 본문을 서버가 받아들일 것인지 확인하려고 할 때, 그 확인 작업을 최적화하기 위한 의도로 도입 된 것입니다.

### 3.4.2 200-299: 성공 상태 코드

-   서버는 대응하는 성공을 의미하는 상태 코드의 배열을 갖고 있으며, 각각 다른 종류의 요청에 대응합니다.

<img width="580" alt="2018-12-30 11 18 43" src="https://user-images.githubusercontent.com/44794974/50548043-4d649100-0c89-11e9-8858-59098a4e334f.png">
<img width="581" alt="2018-12-30 11 18 53" src="https://user-images.githubusercontent.com/44794974/50548045-5190ae80-0c89-11e9-9c91-4e79b04c1e5e.png">

### 3.4.3 300-399: 리다이렉션 상태 코드

-   리다이렉션 상태 코드는 클라이언트가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 그 리소스의 내용 대신 다른 대안 응답을 제공합니다.

<img width="582" alt="2018-12-31 12 48 58" src="https://user-images.githubusercontent.com/44794974/50554237-7cffb180-0cfa-11e9-8b80-24eee87f9e95.png">
<img width="579" alt="2018-12-31 12 49 11" src="https://user-images.githubusercontent.com/44794974/50554239-7f620b80-0cfa-11e9-8b7d-d8bd6545e5c4.png">

-   표를 보면, 302, 303, 307 상태 코드 사이에서 중복되는 부분이 있습니다. 이는 HTTP/1.0 과 HTTP/1.1 애플리케이션이 이 상태 코드를 다루는 방식의 차이점입니다.

### 3.4.4 400-499: 클라이언트 에러 상태 코드

-   클라이언트는 서버가 다룰 수 없는 요청메시지를 보냈을대 400번대의 에러 메세지를 보냅니다.

-   대표적으로 404 Not Found 에러는 서버에서 알 수 없는 리소스를에 대한 요청을 했다고 말해주는 것입니다.

<img width="579" alt="2018-12-31 12 55 34" src="https://user-images.githubusercontent.com/44794974/50554297-6574f880-0cfb-11e9-8fd8-003360856e99.png">
<img width="580" alt="2018-12-31 12 55 41" src="https://user-images.githubusercontent.com/44794974/50554298-6c037000-0cfb-11e9-9035-3d63475545de.png">

### 3.4.5 500-599: 서버 에러 상태 코드

-   클라이언트가 올바른 요청을 보냇음에도 서버 자체에서 에러가 발생하거나, 프락시에서 에러를 만나게 됐을때에는 500번대 서버 에러 상태 코드를 생성합니다.

## 3.5 헤더

헤더는 크게 다섯 가지로 분류됩니다.

### 3.5.1 일반 헤더(General Headers)

-   일반 헤더는 메시지에 대한 아주 기본족인 정보를 제공합니다.

#### 일반 캐시 헤더

-   HTTP/1.0 이상 부터는 매번 원 서버로부터 객체를 가져도는 대신 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더를 도입했습니다.

<img width="582" alt="2018-12-31 3 59 10" src="https://user-images.githubusercontent.com/44794974/50555831-0d4af000-0d15-11e9-96c6-1c9f93a6685d.png">

### 3.5.2 요청 헤더

-   요청 헤더는 요청 메시지에서만 필요한 헤더로, 요청이 발생한 곳에 대한 정보와 클라이언트의 능력을 알려 줍니다.

<img width="582" alt="2018-12-31 4 10 49" src="https://user-images.githubusercontent.com/44794974/50555974-b6461a80-0d16-11e9-80ad-ca37d27ec712.png">
<img width="580" alt="2018-12-31 4 11 07" src="https://user-images.githubusercontent.com/44794974/50555976-b8a87480-0d16-11e9-88ee-e825b09929f1.png">

#### Accept 관련 헤더

-   Accept 관련 헤더들은 클라이언트가 선호하는 정보들을 알려주어, 서버에서 클라이언트가 사용할 수 없는 것에대한 전송을 막아 시간과 대역폭의 낭비를 줄일 수 있습니다.

<img width="582" alt="2018-12-31 4 13 59" src="https://user-images.githubusercontent.com/44794974/50556014-2785cd80-0d17-11e9-8571-153c70141c7d.png">

#### 조건부 요청 헤더

-   클라이언트는 요청에 몇몇 제약을 넣어 서버에게 요청을 응답하기 전에 먼저 조건을 확인할 수 있도록 합니다.

<img width="581" alt="2018-12-31 4 16 59" src="https://user-images.githubusercontent.com/44794974/50556055-906d4580-0d17-11e9-9f23-01feb3b4aefe.png">
<img width="581" alt="2018-12-31 4 17 10" src="https://user-images.githubusercontent.com/44794974/50556056-93683600-0d17-11e9-88fd-39cb14b8f35f.png">

#### 요청 보안 헤더

-   HTTP는 자체적으로 요청을 위한 간다한 인증요구/응답 체계를 가지고 있습니다.

-   이를 통해 클라이언트가 어느 정도의 리소스에 접근하기 전에 자신을 인증하게 함으로써 트랜잭션을 약간 더 안전하게 만들고자 합니다.

#### 프락시 요청 헤더

-   프락시 기능을 돕기위해 헤드들이 추가되어 집니다.

<img width="582" alt="2018-12-31 4 21 49" src="https://user-images.githubusercontent.com/44794974/50556106-3e78ef80-0d18-11e9-8549-cfb236f6013d.png">
<img width="578" alt="2018-12-31 4 22 02" src="https://user-images.githubusercontent.com/44794974/50556109-4173e000-0d18-11e9-9dd5-cd56aff15d9b.png">

### 3.5.3 응답 헤더

-   응답 헤더는 클라이언트에게 누가 응답을 보내고, 응답자의 능력이 어떻게 되는지 정보를 제공하여 클라이언트가 보다 응답을 잘 다루고 더 나은 요청을 할 수 있도록 도와줍니다.

![2018-12-31 4 26 16](https://user-images.githubusercontent.com/44794974/50556165-d4ad1580-0d18-11e9-906e-48f68228fa45.png)

#### 협상 헤더

-   서버에서 프랑스어와 독일어로 번역된 HTML 문서가 있는 경우와 같이 여러 가지 표현이 가능한 상황이라면, 어떤 표현을 택할 것인가에 대한 협상을 할 수 있도록 지원합니다.

<img width="581" alt="2018-12-31 4 29 55" src="https://user-images.githubusercontent.com/44794974/50556214-54d37b00-0d19-11e9-8db7-4c8410e653b1.png">

#### 응답 보안 헤더

-   HTTP 인증요구/ 응답체계에서 응답측에 포함된 보안 헤더들입니다.

<img width="582" alt="2018-12-31 4 32 28" src="https://user-images.githubusercontent.com/44794974/50556233-b1369a80-0d19-11e9-8fb3-e9a2cbaf0a55.png">

### 3.5.4 엔터티 헤더

-   **엔터티 헤더**는 메시지의 본문에 들어있는 내용물에 대한, 개체의 타입부터 시작하여 주어진 리소스에 대해 요청할 수 있는 유효한 메서드들까지 광범위한 정보를 제공합니다.

<img width="582" alt="2018-12-31 4 35 10" src="https://user-images.githubusercontent.com/44794974/50556263-12f70480-0d1a-11e9-8d86-2d26ec966480.png">

#### 콘텐츠 헤더

-   **콘첸츠 헤더**는 엔터티의 콘텐츠에 대한 종류, 크기 등 콘텐츠를 처리할때 유용하게 활용될 수 있는 정보들을 가지고 있습니다.

<img width="581" alt="2018-12-31 4 37 33" src="https://user-images.githubusercontent.com/44794974/50556284-73864180-0d1a-11e9-843e-00563e8defbb.png">
<img width="581" alt="2018-12-31 4 37 51" src="https://user-images.githubusercontent.com/44794974/50556285-784af580-0d1a-11e9-9fb6-485f36592ffc.png">

#### 엔터티 캐싱 헤더

-   **엔터티 캐싱 헤더**는 캐시된 사본이 아직 유효한지와 같은 캐싱 정보를 제공합니다.

<img width="581" alt="2018-12-31 4 42 06" src="https://user-images.githubusercontent.com/44794974/50556324-09ba6780-0d1b-11e9-886a-31cd9bbb213a.png">
